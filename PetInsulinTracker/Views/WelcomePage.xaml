<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:mi="http://www.aathifmahir.com/dotnet/2022/maui/icons"
             xmlns:local="clr-namespace:PetInsulinTracker.Views"
             x:Class="PetInsulinTracker.Views.WelcomePage"
             Shell.NavBarIsVisible="False"
             BackgroundColor="{DynamicResource PageBackground}">

    <Grid>
    <ScrollView>
        <VerticalStackLayout VerticalOptions="Center" Spacing="20" Padding="32,48,32,32">

            <!-- Step indicator -->
            <HorizontalStackLayout HorizontalOptions="Center" Spacing="8">
                <BoxView x:Name="Dot1" WidthRequest="8" HeightRequest="8" CornerRadius="4"
                         Color="{DynamicResource CurrentPrimary}" />
                <BoxView x:Name="Dot2" WidthRequest="8" HeightRequest="8" CornerRadius="4"
                         Color="{DynamicResource CurrentDivider}" />
                <BoxView x:Name="Dot3" WidthRequest="8" HeightRequest="8" CornerRadius="4"
                         Color="{DynamicResource CurrentDivider}" />
                <BoxView x:Name="Dot4" WidthRequest="8" HeightRequest="8" CornerRadius="4"
                         Color="{DynamicResource CurrentDivider}" />
                <BoxView x:Name="Dot5" WidthRequest="8" HeightRequest="8" CornerRadius="4"
                         Color="{DynamicResource CurrentDivider}" />
                <BoxView x:Name="Dot6" WidthRequest="8" HeightRequest="8" CornerRadius="4"
                         Color="{DynamicResource CurrentDivider}" />
            </HorizontalStackLayout>

            <!-- ===== STEP 1: Theme + Name ===== -->
            <VerticalStackLayout x:Name="Step1" Spacing="20" IsVisible="True">

                <mi:MauiIcon Icon="{mi:Fluent AnimalDog24}" IconSize="56" IconColor="{DynamicResource CurrentPrimary}" HorizontalOptions="Center" />

                <Label Text="Welcome to Pawse"
                       FontSize="26" FontFamily="OpenSansSemibold"
                       TextColor="{DynamicResource PageText}"
                       HorizontalOptions="Center" HorizontalTextAlignment="Center" />

                <Label Text="Let's set things up. First, set your name pick a color theme for Pawse."
                       FontSize="14" TextColor="{DynamicResource PageTextSecondary}"
                       HorizontalOptions="Center" HorizontalTextAlignment="Center" />

                <Label Text="What's your name?" FontSize="14"
                       TextColor="{DynamicResource PageTextSecondary}"
                       HorizontalOptions="Center" HorizontalTextAlignment="Center"
                       Margin="0,8,0,0" />

                <Border Style="{StaticResource CardStyle}" Padding="16">
                    <VerticalStackLayout Spacing="8">
                        <Label Text="Your Name" Style="{StaticResource FormLabelStyle}" />
                        <Entry x:Name="NameEntry" Placeholder="e.g., James"
                               FontSize="18" HorizontalTextAlignment="Center"
                               ReturnType="Next" />
                    </VerticalStackLayout>
                </Border>

                <!-- Theme Carousel -->
                <CarouselView x:Name="ThemeCarousel"
                              HeightRequest="180"
                              Margin="-32,0"
                              PeekAreaInsets="40"
                              Loop="False"
                              CurrentItemChanged="OnThemeCarouselChanged"
                              HorizontalOptions="Fill">
                    <CarouselView.ItemTemplate>
                        <DataTemplate x:DataType="local:ThemePreview">
                            <Border StrokeShape="RoundRectangle 16"
                                    StrokeThickness="3"
                                    Stroke="{Binding BorderColor}"
                                    Margin="6" Padding="0"
                                    BackgroundColor="{Binding Background}">
                                <Grid RowDefinitions="44,*,Auto" Padding="0">
                                    <BoxView Grid.Row="0" Color="{Binding Shell}"
                                             CornerRadius="16,16,0,0" />
                                    <Label Grid.Row="0" Text="Pawse" FontSize="13"
                                           FontFamily="OpenSansSemibold" TextColor="White"
                                           VerticalOptions="Center" Margin="14,0,0,0" />
                                    <VerticalStackLayout Grid.Row="1" Spacing="8" Padding="14,10">
                                        <Border BackgroundColor="{Binding Card}"
                                                StrokeShape="RoundRectangle 8"
                                                StrokeThickness="0" Padding="10,8"
                                                HeightRequest="32">
                                            <BoxView Color="{Binding Primary}" CornerRadius="4"
                                                     HeightRequest="10" WidthRequest="80"
                                                     HorizontalOptions="Start" />
                                        </Border>
                                        <Border BackgroundColor="{Binding Card}"
                                                StrokeShape="RoundRectangle 8"
                                                StrokeThickness="0" Padding="10,8"
                                                HeightRequest="28">
                                            <BoxView Color="{Binding Secondary}" CornerRadius="4"
                                                     HeightRequest="8" WidthRequest="60"
                                                     HorizontalOptions="Start" />
                                        </Border>
                                    </VerticalStackLayout>
                                    <Label Grid.Row="2" Text="{Binding Name}"
                                           FontSize="13" FontFamily="OpenSansSemibold"
                                           TextColor="{Binding TextColor}"
                                           HorizontalOptions="Center" Margin="0,0,0,10" />
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CarouselView.ItemTemplate>
                </CarouselView>

                <IndicatorView x:Name="ThemeIndicator"
                               HorizontalOptions="Center"
                               IndicatorColor="{DynamicResource CurrentDivider}"
                               SelectedIndicatorColor="{DynamicResource CurrentPrimary}"
                               IndicatorSize="8" />

                

                <Button Text="Next"
                        Style="{StaticResource PrimaryButtonStyle}"
                        HorizontalOptions="Fill"
                        Clicked="OnStep1Next" />
            </VerticalStackLayout>

            <!-- ===== STEP 2: Owner or Pet Sitter ===== -->
            <VerticalStackLayout x:Name="Step2" Spacing="20" IsVisible="False">

                <mi:MauiIcon Icon="{mi:Fluent People24}" IconSize="48" IconColor="{DynamicResource CurrentPrimary}" HorizontalOptions="Center" />

                <Label Text="How will you use Pawse?"
                       FontSize="24" FontFamily="OpenSansSemibold"
                       TextColor="{DynamicResource PageText}"
                       HorizontalOptions="Center" HorizontalTextAlignment="Center" />

                <Label Text="Are you managing your own pet's care, or were you given a share code by someone else?"
                       FontSize="14" TextColor="{DynamicResource PageTextSecondary}"
                       HorizontalOptions="Center" HorizontalTextAlignment="Center" />

                <VerticalStackLayout x:Name="Step2Buttons" Spacing="20">
                    <Button Text="I'm a Pet Owner"
                            Style="{StaticResource PrimaryButtonStyle}"
                            HorizontalOptions="Fill"
                            Clicked="OnRoleOwner" />

                    <Button Text="I Have a Share Code"
                            Style="{StaticResource OutlineButtonStyle}"
                            HorizontalOptions="Fill"
                            Clicked="OnRoleSitter" />
                </VerticalStackLayout>

                <Button Text="Back"
                        Style="{StaticResource OutlineButtonStyle}"
                        HorizontalOptions="Fill"
                        Clicked="OnStep2Back" />

                <!-- Pet sitter redeem section (hidden until tapped) -->
                <VerticalStackLayout x:Name="SitterRedeemSection" Spacing="12" IsVisible="False">
                    <BoxView Style="{StaticResource DividerStyle}" Margin="0,4" />

                    <Label Text="Enter the share code you received:"
                           FontSize="14" TextColor="{DynamicResource PageTextSecondary}"
                           HorizontalOptions="Center" HorizontalTextAlignment="Center" />

                    <Border Style="{StaticResource CardStyle}" Padding="16">
                        <VerticalStackLayout Spacing="12">
                            <Entry x:Name="SitterRedeemCodeEntry" Placeholder="e.g., ABC123"
                                   CharacterSpacing="4" FontSize="22" FontFamily="OpenSansSemibold"
                                   HorizontalTextAlignment="Center" MaxLength="6" />
                            <Button x:Name="SitterRedeemButton" Text="Import Pet"
                                    Style="{StaticResource PrimaryButtonStyle}"
                                    HorizontalOptions="Fill"
                                    Clicked="OnSitterRedeem" />
                        </VerticalStackLayout>
                    </Border>

                    <Button Text="Cancel"
                            Style="{StaticResource OutlineButtonStyle}"
                            HorizontalOptions="Fill"
                            Clicked="OnSitterCancel" />

                    <Label x:Name="SitterStatusLabel" FontSize="14" FontFamily="OpenSansSemibold"
                           HorizontalTextAlignment="Center"
                           TextColor="{DynamicResource CurrentPrimary}"
                           IsVisible="False" />
                </VerticalStackLayout>
            </VerticalStackLayout>

            <!-- ===== STEP 2.5: Online Sync ===== -->
            <VerticalStackLayout x:Name="Step2_5" Spacing="20" IsVisible="False">

                <mi:MauiIcon Icon="{mi:Fluent CloudSync24}" IconSize="48" IconColor="{DynamicResource CurrentPrimary}" HorizontalOptions="Center" />

                <Label Text="Sync Settings"
                       FontSize="24" FontFamily="OpenSansSemibold"
                       TextColor="{DynamicResource PageText}"
                       HorizontalOptions="Center" HorizontalTextAlignment="Center" />

                <Label Text="Choose whether to sync your pet data to the cloud or keep everything local on this device."
                       FontSize="14" TextColor="{DynamicResource PageTextSecondary}"
                       HorizontalOptions="Center" HorizontalTextAlignment="Center" />

                <Border Style="{StaticResource CardStyle}" Padding="20">
                    <VerticalStackLayout Spacing="16">
                        <HorizontalStackLayout Spacing="12">
                            <Switch x:Name="OnlineSyncSwitch" IsToggled="True" VerticalOptions="Center" />
                            <VerticalStackLayout Spacing="4" HorizontalOptions="Fill">
                                <Label Text="Online Sync" FontFamily="OpenSansSemibold" FontSize="16" />
                                <Label Text="Sync data to the cloud" Style="{StaticResource SubtleTextStyle}" FontSize="12" />
                            </VerticalStackLayout>
                        </HorizontalStackLayout>

                        <BoxView Style="{StaticResource DividerStyle}" Margin="0,4" />

                        <VerticalStackLayout Spacing="8">
                            <Label Text="Online Sync (Recommended)" FontFamily="OpenSansSemibold" FontSize="14" />
                            <Label Text="• Access your pet's data from multiple devices" Style="{StaticResource SubtleTextStyle}" FontSize="12" />
                            <Label Text="• Share pet care with family or pet sitters" Style="{StaticResource SubtleTextStyle}" FontSize="12" />
                            <Label Text="• Automatic backups" Style="{StaticResource SubtleTextStyle}" FontSize="12" />
                        </VerticalStackLayout>

                        <VerticalStackLayout Spacing="8">
                            <Label Text="Offline Mode" FontFamily="OpenSansSemibold" FontSize="14" />
                            <Label Text="• All data stays on this device only" Style="{StaticResource SubtleTextStyle}" FontSize="12" />
                            <Label Text="• No cloud storage or sharing" Style="{StaticResource SubtleTextStyle}" FontSize="12" />
                            <Label Text="• You can change this later in Settings" Style="{StaticResource SubtleTextStyle}" FontSize="12" />
                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </Border>

                <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                    <Button Grid.Column="0" Text="Back"
                            Style="{StaticResource OutlineButtonStyle}"
                            HorizontalOptions="Fill"
                            Clicked="OnStep2_5Back" />
                    <Button Grid.Column="1" Text="Continue"
                            Style="{StaticResource PrimaryButtonStyle}"
                            HorizontalOptions="Fill"
                            Clicked="OnStep2_5Next" />
                </Grid>
            </VerticalStackLayout>

            <!-- ===== STEP 3: Add First Pet (Optional) ===== -->
            <VerticalStackLayout x:Name="Step3" Spacing="16" IsVisible="False">

                <mi:MauiIcon Icon="{mi:Fluent AnimalDog24}" IconSize="48" IconColor="{DynamicResource CurrentPrimary}" HorizontalOptions="Center" />

                <Label Text="Add Your Pet"
                       FontSize="24" FontFamily="OpenSansSemibold"
                       TextColor="{DynamicResource PageText}"
                       HorizontalOptions="Center" HorizontalTextAlignment="Center" />

                <Label Text="Tell us about your furry friend. You can always add or edit pets later."
                       FontSize="14" TextColor="{DynamicResource PageTextSecondary}"
                       HorizontalOptions="Center" HorizontalTextAlignment="Center" />

                <!-- Care Type Toggles -->
                <Border Style="{StaticResource CardStyle}" Padding="16">
                    <VerticalStackLayout Spacing="12">
                        <Label Text="What care will you track?" FontFamily="OpenSansSemibold" FontSize="15" />
                        
                        <HorizontalStackLayout Spacing="12">
                            <Switch x:Name="TrackInsulinSwitch" IsToggled="True" VerticalOptions="Center" Toggled="OnTrackInsulinToggled" />
                            <VerticalStackLayout Spacing="2" HorizontalOptions="Fill">
                                <Label Text="Track Insulin" FontFamily="OpenSansSemibold" FontSize="14" />
                                <Label Text="For diabetic pets requiring insulin" Style="{StaticResource SubtleTextStyle}" FontSize="12" />
                            </VerticalStackLayout>
                        </HorizontalStackLayout>

                        <BoxView Style="{StaticResource DividerStyle}" Margin="0,4" />

                        <HorizontalStackLayout Spacing="12">
                            <Switch x:Name="TrackMedicationSwitch" IsToggled="False" VerticalOptions="Center" Toggled="OnTrackMedicationToggled" />
                            <VerticalStackLayout Spacing="2" HorizontalOptions="Fill">
                                <Label Text="Track Medications" FontFamily="OpenSansSemibold" FontSize="14" />
                                <Label Text="For pets on regular medications" Style="{StaticResource SubtleTextStyle}" FontSize="12" />
                            </VerticalStackLayout>
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </Border>

                <Border Style="{StaticResource CardStyle}" Padding="16">
                    <VerticalStackLayout Spacing="12">
                        <VerticalStackLayout Spacing="4">
                            <Label Text="Pet Name" Style="{StaticResource FormLabelStyle}" />
                            <Entry x:Name="PetNameEntry" Placeholder="e.g., Whiskers" />
                        </VerticalStackLayout>
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                            <VerticalStackLayout Grid.Column="0" Spacing="4">
                                <Label Text="Species" Style="{StaticResource FormLabelStyle}" />
                                <Picker x:Name="SpeciesPicker">
                                    <Picker.ItemsSource>
                                        <x:Array Type="{x:Type x:String}">
                                            <x:String>Dog</x:String>
                                            <x:String>Cat</x:String>
                                        </x:Array>
                                    </Picker.ItemsSource>
                                    <Picker.SelectedItem>
                                        <x:String>Dog</x:String>
                                    </Picker.SelectedItem>
                                </Picker>
                            </VerticalStackLayout>
                            <VerticalStackLayout Grid.Column="1" Spacing="4">
                                <Label Text="Breed" Style="{StaticResource FormLabelStyle}" />
                                <Entry x:Name="BreedEntry" Placeholder="e.g., Labrador" />
                            </VerticalStackLayout>
                        </Grid>
                    </VerticalStackLayout>
                </Border>

                <!-- Insulin Info -->
                <Border x:Name="InsulinInfoCard" Style="{StaticResource CardStyle}" Padding="16" IsVisible="True">
                    <VerticalStackLayout Spacing="12">
                        <Label Text="Insulin (if applicable)" FontFamily="OpenSansSemibold" FontSize="15" />
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                            <VerticalStackLayout Grid.Column="0" Spacing="4">
                                <Label Text="Insulin Type" Style="{StaticResource FormLabelStyle}" />
                                <Picker x:Name="InsulinTypePicker">
                                    <Picker.ItemsSource>
                                        <x:Array Type="{x:Type x:String}">
                                            <x:String>Vetsulin</x:String>
                                            <x:String>ProZinc</x:String>
                                            <x:String>NPH (Humulin N)</x:String>
                                            <x:String>Glargine (Lantus)</x:String>
                                            <x:String>Other</x:String>
                                        </x:Array>
                                    </Picker.ItemsSource>
                                </Picker>
                            </VerticalStackLayout>
                            <VerticalStackLayout Grid.Column="1" Spacing="4">
                                <Label Text="Concentration" Style="{StaticResource FormLabelStyle}" />
                                <Picker x:Name="ConcentrationPicker">
                                    <Picker.ItemsSource>
                                        <x:Array Type="{x:Type x:String}">
                                            <x:String>U-40</x:String>
                                            <x:String>U-100</x:String>
                                        </x:Array>
                                    </Picker.ItemsSource>
                                    <Picker.SelectedItem>
                                        <x:String>U-40</x:String>
                                    </Picker.SelectedItem>
                                </Picker>
                            </VerticalStackLayout>
                        </Grid>
                        <VerticalStackLayout Spacing="4">
                            <Label Text="Dose (IU)" Style="{StaticResource FormLabelStyle}" />
                            <Entry x:Name="DoseEntry" Placeholder="e.g., 2.0" Keyboard="Numeric" />
                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </Border>

                <!-- Medication Info -->
                <Border x:Name="MedicationInfoCard" Style="{StaticResource CardStyle}" Padding="16" IsVisible="False">
                    <VerticalStackLayout Spacing="12">
                        <Label Text="Medication Details" FontFamily="OpenSansSemibold" FontSize="15" />
                        <VerticalStackLayout Spacing="4">
                            <Label Text="Medication Information" Style="{StaticResource FormLabelStyle}" />
                            <Entry x:Name="MedicationEntry" Placeholder="e.g., Gabapentin 100mg twice daily" />
                            <Label Text="You can add multiple medications later" Style="{StaticResource SubtleTextStyle}" FontSize="11" />
                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </Border>

                <!-- Weight -->
                <Border Style="{StaticResource CardStyle}" Padding="16">
                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                        <VerticalStackLayout Grid.Column="0" Spacing="4">
                            <Label Text="Goal Weight" Style="{StaticResource FormLabelStyle}" />
                            <Entry x:Name="WeightEntry" Placeholder="Weight" Keyboard="Numeric" />
                        </VerticalStackLayout>
                        <VerticalStackLayout Grid.Column="1" Spacing="4">
                            <Label Text="Unit" Style="{StaticResource FormLabelStyle}" />
                            <Picker x:Name="WeightUnitPicker" WidthRequest="80">
                                <Picker.ItemsSource>
                                    <x:Array Type="{x:Type x:String}">
                                        <x:String>lbs</x:String>
                                        <x:String>kg</x:String>
                                    </x:Array>
                                </Picker.ItemsSource>
                                <Picker.SelectedItem>
                                    <x:String>lbs</x:String>
                                </Picker.SelectedItem>
                            </Picker>
                        </VerticalStackLayout>
                    </Grid>
                </Border>

                <!-- Feeding Defaults -->
                <Border Style="{StaticResource CardStyle}" Padding="16">
                    <VerticalStackLayout Spacing="12">
                        <Label Text="Feeding Defaults" FontFamily="OpenSansSemibold" FontSize="15" />
                        <VerticalStackLayout Spacing="4">
                            <Label Text="Food Name" Style="{StaticResource FormLabelStyle}" />
                            <Entry x:Name="FoodNameEntry" Placeholder="e.g., Royal Canin Diabetic" />
                        </VerticalStackLayout>
                        <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="12">
                            <VerticalStackLayout Grid.Column="0" Spacing="4">
                                <Label Text="Amount per Meal" Style="{StaticResource FormLabelStyle}" />
                                <Entry x:Name="FoodAmountEntry" Placeholder="e.g., 0.5" Keyboard="Numeric" />
                            </VerticalStackLayout>
                            <VerticalStackLayout Grid.Column="1" Spacing="4">
                                <Label Text="Unit" Style="{StaticResource FormLabelStyle}" />
                                <Picker x:Name="FoodUnitPicker" WidthRequest="90">
                                    <Picker.ItemsSource>
                                        <x:Array Type="{x:Type x:String}">
                                            <x:String>cups</x:String>
                                            <x:String>grams</x:String>
                                            <x:String>oz</x:String>
                                            <x:String>cans</x:String>
                                        </x:Array>
                                    </Picker.ItemsSource>
                                    <Picker.SelectedItem>
                                        <x:String>cups</x:String>
                                    </Picker.SelectedItem>
                                </Picker>
                            </VerticalStackLayout>
                            <VerticalStackLayout Grid.Column="2" Spacing="4">
                                <Label Text="Type" Style="{StaticResource FormLabelStyle}" />
                                <Picker x:Name="FoodTypePicker" WidthRequest="80">
                                    <Picker.ItemsSource>
                                        <x:Array Type="{x:Type x:String}">
                                            <x:String>Dry</x:String>
                                            <x:String>Wet</x:String>
                                            <x:String>Treat</x:String>
                                        </x:Array>
                                    </Picker.ItemsSource>
                                    <Picker.SelectedItem>
                                        <x:String>Dry</x:String>
                                    </Picker.SelectedItem>
                                </Picker>
                            </VerticalStackLayout>
                        </Grid>
                    </VerticalStackLayout>
                </Border>

                <Grid ColumnDefinitions="*,*,*" ColumnSpacing="12">
                    <Button Grid.Column="0" Text="Back"
                            Style="{StaticResource OutlineButtonStyle}"
                            HorizontalOptions="Fill"
                            Clicked="OnStep3Back" />
                    <Button Grid.Column="1" Text="Skip"
                            Style="{StaticResource OutlineButtonStyle}"
                            HorizontalOptions="Fill"
                            Clicked="OnStep3Skip" />
                    <Button Grid.Column="2" Text="Next"
                            Style="{StaticResource PrimaryButtonStyle}"
                            HorizontalOptions="Fill"
                            Clicked="OnStep3Next" />
                </Grid>
            </VerticalStackLayout>

            <!-- ===== STEP 4: Schedule Setup (Optional) ===== -->
            <VerticalStackLayout x:Name="Step4" Spacing="16" IsVisible="False">

                <mi:MauiIcon Icon="{mi:Fluent CalendarAgenda24}" IconSize="48" IconColor="{DynamicResource CurrentPrimary}" HorizontalOptions="Center" />

                <Label Text="Set Up Schedules"
                       FontSize="24" FontFamily="OpenSansSemibold"
                       TextColor="{DynamicResource PageText}"
                       HorizontalOptions="Center" HorizontalTextAlignment="Center" />

                <Label x:Name="Step4Description" Text="Optionally set up insulin and feeding times. You can always do this later."
                       FontSize="14" TextColor="{DynamicResource PageTextSecondary}"
                       HorizontalOptions="Center" HorizontalTextAlignment="Center" />

                <!-- Morning Insulin & Feeding (Combined) -->
                <Border x:Name="MorningCombinedCard" Style="{StaticResource CardStyle}" Padding="16" IsVisible="True">
                    <VerticalStackLayout Spacing="12">
                        <Label Text="Morning Insulin &amp; Feeding" FontFamily="OpenSansSemibold" FontSize="16" />
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                            <VerticalStackLayout Grid.Column="0" Spacing="4">
                                <Label Text="Time" Style="{StaticResource FormLabelStyle}" />
                                <TimePicker x:Name="MorningCombinedTime" Time="08:00:00" />
                            </VerticalStackLayout>
                            <VerticalStackLayout Grid.Column="1" Spacing="4">
                                <Label Text="Remind (min before)" Style="{StaticResource FormLabelStyle}" />
                                <Entry x:Name="MorningCombinedReminder" Text="15" Keyboard="Numeric" />
                            </VerticalStackLayout>
                        </Grid>
                        <HorizontalStackLayout Spacing="8">
                            <Switch x:Name="MorningCombinedEnabled" IsToggled="True" />
                            <Label Text="Add this schedule" VerticalOptions="Center"
                                   Style="{StaticResource SubtleTextStyle}" />
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </Border>

                <!-- Evening Insulin & Feeding (Combined) -->
                <Border x:Name="EveningCombinedCard" Style="{StaticResource CardStyle}" Padding="16" IsVisible="True">
                    <VerticalStackLayout Spacing="12">
                        <Label Text="Evening Insulin &amp; Feeding" FontFamily="OpenSansSemibold" FontSize="16" />
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                            <VerticalStackLayout Grid.Column="0" Spacing="4">
                                <Label Text="Time" Style="{StaticResource FormLabelStyle}" />
                                <TimePicker x:Name="EveningCombinedTime" Time="20:00:00" />
                            </VerticalStackLayout>
                            <VerticalStackLayout Grid.Column="1" Spacing="4">
                                <Label Text="Remind (min before)" Style="{StaticResource FormLabelStyle}" />
                                <Entry x:Name="EveningCombinedReminder" Text="15" Keyboard="Numeric" />
                            </VerticalStackLayout>
                        </Grid>
                        <HorizontalStackLayout Spacing="8">
                            <Switch x:Name="EveningCombinedEnabled" IsToggled="True" />
                            <Label Text="Add this schedule" VerticalOptions="Center"
                                   Style="{StaticResource SubtleTextStyle}" />
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </Border>

                <!-- Morning Insulin -->
                <Border x:Name="MorningInsulinCard" Style="{StaticResource CardStyle}" Padding="16" IsVisible="False">
                    <VerticalStackLayout Spacing="12">
                        <Label Text="Morning Insulin" FontFamily="OpenSansSemibold" FontSize="16" />
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                            <VerticalStackLayout Grid.Column="0" Spacing="4">
                                <Label Text="Time" Style="{StaticResource FormLabelStyle}" />
                                <TimePicker x:Name="MorningInsulinTime" Time="08:00:00" />
                            </VerticalStackLayout>
                            <VerticalStackLayout Grid.Column="1" Spacing="4">
                                <Label Text="Remind (min before)" Style="{StaticResource FormLabelStyle}" />
                                <Entry x:Name="MorningInsulinReminder" Text="15" Keyboard="Numeric" />
                            </VerticalStackLayout>
                        </Grid>
                        <HorizontalStackLayout Spacing="8">
                            <Switch x:Name="MorningInsulinEnabled" IsToggled="False" />
                            <Label Text="Add this schedule" VerticalOptions="Center"
                                   Style="{StaticResource SubtleTextStyle}" />
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </Border>

                <!-- Evening Insulin -->
                <Border x:Name="EveningInsulinCard" Style="{StaticResource CardStyle}" Padding="16" IsVisible="False">
                    <VerticalStackLayout Spacing="12">
                        <Label Text="Evening Insulin" FontFamily="OpenSansSemibold" FontSize="16" />
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                            <VerticalStackLayout Grid.Column="0" Spacing="4">
                                <Label Text="Time" Style="{StaticResource FormLabelStyle}" />
                                <TimePicker x:Name="EveningInsulinTime" Time="20:00:00" />
                            </VerticalStackLayout>
                            <VerticalStackLayout Grid.Column="1" Spacing="4">
                                <Label Text="Remind (min before)" Style="{StaticResource FormLabelStyle}" />
                                <Entry x:Name="EveningInsulinReminder" Text="15" Keyboard="Numeric" />
                            </VerticalStackLayout>
                        </Grid>
                        <HorizontalStackLayout Spacing="8">
                            <Switch x:Name="EveningInsulinEnabled" IsToggled="False" />
                            <Label Text="Add this schedule" VerticalOptions="Center"
                                   Style="{StaticResource SubtleTextStyle}" />
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </Border>

                <!-- Morning Feeding -->
                <Border x:Name="MorningFeedingCard" Style="{StaticResource CardStyle}" Padding="16" IsVisible="False">
                    <VerticalStackLayout Spacing="12">
                        <Label Text="Morning Feeding" FontFamily="OpenSansSemibold" FontSize="16" />
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                            <VerticalStackLayout Grid.Column="0" Spacing="4">
                                <Label Text="Time" Style="{StaticResource FormLabelStyle}" />
                                <TimePicker x:Name="MorningFeedingTime" Time="08:00:00" />
                            </VerticalStackLayout>
                            <VerticalStackLayout Grid.Column="1" Spacing="4">
                                <Label Text="Remind (min before)" Style="{StaticResource FormLabelStyle}" />
                                <Entry x:Name="MorningFeedingReminder" Text="15" Keyboard="Numeric" />
                            </VerticalStackLayout>
                        </Grid>
                        <HorizontalStackLayout Spacing="8">
                            <Switch x:Name="MorningFeedingEnabled" IsToggled="False" />
                            <Label Text="Add this schedule" VerticalOptions="Center"
                                   Style="{StaticResource SubtleTextStyle}" />
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </Border>

                <!-- Evening Feeding -->
                <Border x:Name="EveningFeedingCard" Style="{StaticResource CardStyle}" Padding="16" IsVisible="False">
                    <VerticalStackLayout Spacing="12">
                        <Label Text="Evening Feeding" FontFamily="OpenSansSemibold" FontSize="16" />
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                            <VerticalStackLayout Grid.Column="0" Spacing="4">
                                <Label Text="Time" Style="{StaticResource FormLabelStyle}" />
                                <TimePicker x:Name="EveningFeedingTime" Time="20:00:00" />
                            </VerticalStackLayout>
                            <VerticalStackLayout Grid.Column="1" Spacing="4">
                                <Label Text="Remind (min before)" Style="{StaticResource FormLabelStyle}" />
                                <Entry x:Name="EveningFeedingReminder" Text="15" Keyboard="Numeric" />
                            </VerticalStackLayout>
                        </Grid>
                        <HorizontalStackLayout Spacing="8">
                            <Switch x:Name="EveningFeedingEnabled" IsToggled="False" />
                            <Label Text="Add this schedule" VerticalOptions="Center"
                                   Style="{StaticResource SubtleTextStyle}" />
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </Border>

                <!-- Morning Medication -->
                <Border x:Name="MorningMedicationCard" Style="{StaticResource CardStyle}" Padding="16" IsVisible="False">
                    <VerticalStackLayout Spacing="12">
                        <Label Text="Morning Medication" FontFamily="OpenSansSemibold" FontSize="16" />
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                            <VerticalStackLayout Grid.Column="0" Spacing="4">
                                <Label Text="Time" Style="{StaticResource FormLabelStyle}" />
                                <TimePicker x:Name="MorningMedicationTime" Time="08:00:00" />
                            </VerticalStackLayout>
                            <VerticalStackLayout Grid.Column="1" Spacing="4">
                                <Label Text="Remind (min before)" Style="{StaticResource FormLabelStyle}" />
                                <Entry x:Name="MorningMedicationReminder" Text="15" Keyboard="Numeric" />
                            </VerticalStackLayout>
                        </Grid>
                        <HorizontalStackLayout Spacing="8">
                            <Switch x:Name="MorningMedicationEnabled" IsToggled="True" />
                            <Label Text="Add this schedule" VerticalOptions="Center"
                                   Style="{StaticResource SubtleTextStyle}" />
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </Border>

                <!-- Evening Medication -->
                <Border x:Name="EveningMedicationCard" Style="{StaticResource CardStyle}" Padding="16" IsVisible="False">
                    <VerticalStackLayout Spacing="12">
                        <Label Text="Evening Medication" FontFamily="OpenSansSemibold" FontSize="16" />
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                            <VerticalStackLayout Grid.Column="0" Spacing="4">
                                <Label Text="Time" Style="{StaticResource FormLabelStyle}" />
                                <TimePicker x:Name="EveningMedicationTime" Time="20:00:00" />
                            </VerticalStackLayout>
                            <VerticalStackLayout Grid.Column="1" Spacing="4">
                                <Label Text="Remind (min before)" Style="{StaticResource FormLabelStyle}" />
                                <Entry x:Name="EveningMedicationReminder" Text="15" Keyboard="Numeric" />
                            </VerticalStackLayout>
                        </Grid>
                        <HorizontalStackLayout Spacing="8">
                            <Switch x:Name="EveningMedicationEnabled" IsToggled="True" />
                            <Label Text="Add this schedule" VerticalOptions="Center"
                                   Style="{StaticResource SubtleTextStyle}" />
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </Border>

                <Border Style="{StaticResource CardStyle}" Padding="16">
                    <VerticalStackLayout Spacing="12">
                        <Label Text="Notifications" FontFamily="OpenSansSemibold" FontSize="16" />
                        <Label Text="Get reminders for the schedules you add on this device."
                               Style="{StaticResource SubtleTextStyle}" FontSize="12" />
                        <HorizontalStackLayout Spacing="8">
                            <Switch x:Name="NotificationsEnabledSwitch" IsToggled="True" />
                            <Label Text="Enable notifications" VerticalOptions="Center"
                                   Style="{StaticResource SubtleTextStyle}" />
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </Border>

                <Grid ColumnDefinitions="*,*,*" ColumnSpacing="12">
                    <Button Grid.Column="0" Text="Back"
                            Style="{StaticResource OutlineButtonStyle}"
                            HorizontalOptions="Fill"
                            Clicked="OnStep4Back" />
                    <Button Grid.Column="1" Text="Skip"
                            Style="{StaticResource OutlineButtonStyle}"
                            HorizontalOptions="Fill"
                            Clicked="OnStep4Skip" />
                    <Button Grid.Column="2" Text="Next"
                            Style="{StaticResource PrimaryButtonStyle}"
                            HorizontalOptions="Fill"
                            Clicked="OnStep4Next" />
                </Grid>
            </VerticalStackLayout>

            <!-- ===== STEP 5: Vet Info (Optional) ===== -->
            <VerticalStackLayout x:Name="Step5" Spacing="16" IsVisible="False">

                <mi:MauiIcon Icon="{mi:Fluent Stethoscope24}" IconSize="48" IconColor="{DynamicResource CurrentPrimary}" HorizontalOptions="Center" />

                <Label Text="Vet Information"
                       FontSize="24" FontFamily="OpenSansSemibold"
                       TextColor="{DynamicResource PageText}"
                       HorizontalOptions="Center" HorizontalTextAlignment="Center" />

                <Label Text="Add your vet's details for quick access in emergencies. You can always do this later."
                       FontSize="14" TextColor="{DynamicResource PageTextSecondary}"
                       HorizontalOptions="Center" HorizontalTextAlignment="Center" />

                <Border Style="{StaticResource CardStyle}" Padding="16">
                    <VerticalStackLayout Spacing="12">
                        <VerticalStackLayout Spacing="4">
                            <Label Text="Vet Name" Style="{StaticResource FormLabelStyle}" />
                            <Entry x:Name="VetNameEntry" Placeholder="e.g., Dr. Smith" />
                        </VerticalStackLayout>
                        <VerticalStackLayout Spacing="4">
                            <Label Text="Clinic Name" Style="{StaticResource FormLabelStyle}" />
                            <Entry x:Name="ClinicNameEntry" Placeholder="e.g., Happy Paws Clinic" />
                        </VerticalStackLayout>
                        <VerticalStackLayout Spacing="4">
                            <Label Text="Phone" Style="{StaticResource FormLabelStyle}" />
                            <Entry x:Name="VetPhoneEntry" Placeholder="(555) 123-4567" Keyboard="Telephone" />
                        </VerticalStackLayout>
                        <VerticalStackLayout Spacing="4">
                            <Label Text="Emergency Phone" Style="{StaticResource FormLabelStyle}" />
                            <Entry x:Name="EmergencyPhoneEntry" Placeholder="(555) 987-6543" Keyboard="Telephone" />
                        </VerticalStackLayout>
                        <VerticalStackLayout Spacing="4">
                            <Label Text="Address" Style="{StaticResource FormLabelStyle}" />
                            <Entry x:Name="VetAddressEntry" Placeholder="123 Main St, Anytown" />
                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </Border>

                <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                    <Button Grid.Column="0" Text="Back"
                            Style="{StaticResource OutlineButtonStyle}"
                            HorizontalOptions="Fill"
                            Clicked="OnStep5Back" />
                    <Button Grid.Column="1" Text="Get Started"
                            Style="{StaticResource PrimaryButtonStyle}"
                            HorizontalOptions="Fill"
                            Clicked="OnStep5Done" />
                </Grid>
            </VerticalStackLayout>

        </VerticalStackLayout>
    </ScrollView>

    <!-- Saving overlay -->
    <Grid x:Name="SavingOverlay" IsVisible="False"
          BackgroundColor="{AppThemeBinding Light=#CC000000, Dark=#CC000000}">
        <VerticalStackLayout VerticalOptions="Center" HorizontalOptions="Center" Spacing="16">
            <ActivityIndicator IsRunning="True" HeightRequest="48" WidthRequest="48"
                               Color="{DynamicResource CurrentPrimary}" />
            <Label x:Name="SavingStatusLabel" Text="Saving…"
                   TextColor="White" FontSize="16" FontFamily="OpenSansSemibold"
                   HorizontalTextAlignment="Center" />
        </VerticalStackLayout>
    </Grid>
    </Grid>

</ContentPage>
