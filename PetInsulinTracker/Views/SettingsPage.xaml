<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:PetInsulinTracker.ViewModels"
             xmlns:mi="http://www.aathifmahir.com/dotnet/2022/maui/icons"
             x:Class="PetInsulinTracker.Views.SettingsPage"
             x:DataType="vm:SettingsViewModel"
             x:Name="SettingsPageRoot"
             Title="Settings"
             BackgroundColor="{DynamicResource PageBackground}">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="16">

            <!-- Profile -->
            <Label Text="PROFILE" Style="{StaticResource OverlineStyle}" />

            <Border Style="{StaticResource CardStyle}">
                <Grid ColumnDefinitions="40,*" ColumnSpacing="12">
                    <Border Grid.Column="0"
                            BackgroundColor="{AppThemeBinding Light=#FFF3E0, Dark=#3D2C1E}"
                            StrokeThickness="0" StrokeShape="RoundRectangle 10"
                            HeightRequest="36" WidthRequest="36">
                        <mi:MauiIcon Icon="{mi:Fluent PersonCircle24}" IconSize="22" IconColor="{DynamicResource PageText}" HorizontalOptions="Center" VerticalOptions="Center" />
                    </Border>
                    <VerticalStackLayout Grid.Column="1" Spacing="4" VerticalOptions="Center">
                        <Label Text="Your Name" Style="{StaticResource FormLabelStyle}" />
                        <Entry Text="{Binding OwnerName}" Placeholder="Enter your name"
                               FontSize="15" />
                    </VerticalStackLayout>
                </Grid>
            </Border>

            <!-- Preferences -->
            <Label Text="PREFERENCES" Style="{StaticResource OverlineStyle}" />

            <Border Style="{StaticResource CardStyle}">
                <VerticalStackLayout Spacing="0">
                    <Grid ColumnDefinitions="40,*,Auto" ColumnSpacing="12" Padding="0,8">
                        <Border Grid.Column="0"
                                BackgroundColor="{AppThemeBinding Light=#E8F5E9, Dark=#1B3D24}"
                                StrokeThickness="0" StrokeShape="RoundRectangle 10"
                                HeightRequest="36" WidthRequest="36">
                            <mi:MauiIcon Icon="{mi:Fluent AlertOn20}" IconSize="22" IconColor="{DynamicResource PageText}" HorizontalOptions="Center" VerticalOptions="Center" />
                        </Border>
                        <Label Grid.Column="1" Text="Notifications" VerticalOptions="Center"
                               FontFamily="OpenSansSemibold" />
                        <Switch Grid.Column="2" IsToggled="{Binding NotificationsEnabled}" />
                    </Grid>

                    <VerticalStackLayout Margin="52,0,0,0" Spacing="8" Padding="0,4">
                        <Label Text="Per pet" Style="{StaticResource SubtleTextStyle}" FontSize="12" />
                        <VerticalStackLayout Spacing="6"
                                             BindableLayout.ItemsSource="{Binding PetNotifications}">
                            <BindableLayout.ItemTemplate>
                                <DataTemplate x:DataType="vm:PetNotificationItem">
                                    <Grid ColumnDefinitions="*,Auto">
                                        <Label Text="{Binding PetName}" VerticalOptions="Center" FontSize="14" />
                                        <Switch Grid.Column="1"
                                                IsToggled="{Binding IsEnabled}"
                                                IsEnabled="{Binding Source={x:Reference SettingsPageRoot}, Path=BindingContext.ArePetNotificationsEnabled}" />
                                    </Grid>
                                </DataTemplate>
                            </BindableLayout.ItemTemplate>
                        </VerticalStackLayout>
                        <Label Text="Turn on global notifications to adjust per-pet reminders."
                               IsVisible="{Binding ShowPerPetNotificationsHint}"
                               Style="{StaticResource SubtleTextStyle}"
                               FontSize="12" />
                    </VerticalStackLayout>

                    <BoxView Style="{StaticResource DividerStyle}" Margin="52,0,0,0" />

                    <Grid ColumnDefinitions="40,*,Auto" ColumnSpacing="12" Padding="0,8">
                        <Border Grid.Column="0"
                                BackgroundColor="{AppThemeBinding Light=#F3E5F5, Dark=#2D1A33}"
                                StrokeThickness="0" StrokeShape="RoundRectangle 10"
                                HeightRequest="36" WidthRequest="36">
                            <mi:MauiIcon Icon="{mi:Fluent CloudOff24}" IconSize="22" IconColor="{DynamicResource PageText}" HorizontalOptions="Center" VerticalOptions="Center" />
                        </Border>
                        <VerticalStackLayout Grid.Column="1" VerticalOptions="Center">
                            <Label Text="Offline Mode" FontFamily="OpenSansSemibold" />
                            <Label Text="Keep all data on this device only"
                                   Style="{StaticResource SubtleTextStyle}" FontSize="12" />
                        </VerticalStackLayout>
                        <Switch Grid.Column="2" IsToggled="{Binding OfflineMode}" />
                    </Grid>

                    <BoxView Style="{StaticResource DividerStyle}" Margin="52,0,0,0" />

                    <Grid ColumnDefinitions="40,*,Auto" ColumnSpacing="12" Padding="0,8">
                        <Border Grid.Column="0"
                                BackgroundColor="{AppThemeBinding Light=#E3F2FD, Dark=#1A2A3D}"
                                StrokeThickness="0" StrokeShape="RoundRectangle 10"
                                HeightRequest="36" WidthRequest="36">
                            <mi:MauiIcon Icon="{mi:Fluent Scales24}" IconSize="22" IconColor="{DynamicResource PageText}" HorizontalOptions="Center" VerticalOptions="Center" />
                        </Border>
                        <Label Grid.Column="1" Text="Default Weight Unit" VerticalOptions="Center"
                               FontFamily="OpenSansSemibold" />
                        <Picker Grid.Column="2" ItemsSource="{Binding WeightUnitOptions}"
                                SelectedItem="{Binding WeightUnit}" WidthRequest="80" />
                    </Grid>

                    <BoxView Style="{StaticResource DividerStyle}" Margin="52,0,0,0" />

                    <Grid ColumnDefinitions="40,*,Auto" ColumnSpacing="12" Padding="0,8">
                        <Border Grid.Column="0"
                                BackgroundColor="{AppThemeBinding Light=#E8EAF6, Dark=#1A1F3D}"
                                StrokeThickness="0" StrokeShape="RoundRectangle 10"
                                HeightRequest="36" WidthRequest="36">
                            <mi:MauiIcon Icon="{mi:Fluent Image24}" IconSize="22" IconColor="{DynamicResource PageText}" HorizontalOptions="Center" VerticalOptions="Center" />
                        </Border>
                        <VerticalStackLayout Grid.Column="1" VerticalOptions="Center">
                            <Label Text="Prefer Local Image" FontFamily="OpenSansSemibold" />
                            <Label Text="Use your original photo instead of remote thumbnail"
                                   Style="{StaticResource SubtleTextStyle}" FontSize="12" />
                        </VerticalStackLayout>
                        <Switch Grid.Column="2" IsToggled="{Binding PreferLocalImage}" />
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- Theme -->
            <Label Text="THEME" Style="{StaticResource OverlineStyle}" />

            <Border Style="{StaticResource CardStyle}">
                <Grid ColumnDefinitions="40,*,Auto" ColumnSpacing="12">
                    <Border Grid.Column="0"
                            BackgroundColor="{AppThemeBinding Light=#FFF3E0, Dark=#3D2C1E}"
                            StrokeThickness="0" StrokeShape="RoundRectangle 10"
                            HeightRequest="36" WidthRequest="36">
                        <mi:MauiIcon Icon="{mi:Fluent PaintBrush24}" IconSize="22" IconColor="{DynamicResource PageText}" HorizontalOptions="Center" VerticalOptions="Center" />
                    </Border>
                    <Label Grid.Column="1" Text="Color Theme" VerticalOptions="Center"
                           FontFamily="OpenSansSemibold" />
                    <Picker Grid.Column="2" ItemsSource="{Binding ThemeDisplayNames}"
                            SelectedItem="{Binding SelectedThemeName}" WidthRequest="160" />
                </Grid>
            </Border>

            <!-- Sync (hidden in offline mode) -->
            <Label Text="SYNC" Style="{StaticResource OverlineStyle}"
                   IsVisible="{Binding IsSyncVisible}" />

            <Border Style="{StaticResource CardStyle}"
                    IsVisible="{Binding IsSyncVisible}">
                <VerticalStackLayout Spacing="12">
                    <Grid ColumnDefinitions="40,*" ColumnSpacing="12">
                        <Border Grid.Column="0"
                                BackgroundColor="{AppThemeBinding Light=#FFF3E0, Dark=#3D2C1E}"
                                StrokeThickness="0" StrokeShape="RoundRectangle 10"
                                HeightRequest="36" WidthRequest="36">
                            <mi:MauiIcon Icon="{mi:Fluent CloudSync20}" IconSize="22" IconColor="{DynamicResource PageText}" HorizontalOptions="Center" VerticalOptions="Center" />
                        </Border>
                        <Label Grid.Column="1" Text="{Binding SyncStatus}"
                               VerticalOptions="Center" Style="{StaticResource SubtleTextStyle}" FontSize="14" />
                    </Grid>
                    <Button Text="Sync Now" Command="{Binding SyncNowCommand}"
                            IsEnabled="{Binding IsSyncing, Converter={StaticResource InvertedBoolConverter}}"
                            Style="{StaticResource OutlineButtonStyle}"
                            HorizontalOptions="Fill" />
                </VerticalStackLayout>
            </Border>

            <!-- About -->
            <Label Text="ABOUT" Style="{StaticResource OverlineStyle}" />

            <Border Style="{StaticResource CardStyle}">
                <VerticalStackLayout Spacing="4">
                    <Label Text="Pet Insulin Tracker" FontFamily="OpenSansSemibold" FontSize="16" />
                    <Label Text="Track your diabetic pet's insulin, feeding, and weight with ease. Share care responsibilities with family and pet sitters."
                           Style="{StaticResource SubtleTextStyle}" FontSize="13" />
                    <Label Text="Version 1.0" Style="{StaticResource SubtleTextStyle}" Margin="0,4,0,0" />
                </VerticalStackLayout>
            </Border>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
