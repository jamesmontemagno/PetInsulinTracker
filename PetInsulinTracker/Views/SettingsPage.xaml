<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:PetInsulinTracker.ViewModels"
             xmlns:mi="http://www.aathifmahir.com/dotnet/2022/maui/icons"
             x:Class="PetInsulinTracker.Views.SettingsPage"
             x:DataType="vm:SettingsViewModel"
             Title="Settings"
             BackgroundColor="{AppThemeBinding Light={StaticResource Background}, Dark={StaticResource BackgroundDark}}">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="16">

            <!-- Profile -->
            <Label Text="PROFILE" Style="{StaticResource OverlineStyle}" />

            <Border Style="{StaticResource CardStyle}">
                <Grid ColumnDefinitions="40,*" ColumnSpacing="12">
                    <Border Grid.Column="0"
                            BackgroundColor="{AppThemeBinding Light=#FFF3E0, Dark=#3D2C1E}"
                            StrokeThickness="0" StrokeShape="RoundRectangle 10"
                            HeightRequest="36" WidthRequest="36">
                        <Image Source="{mi:Fluent Icon=PersonCircle24}" HeightRequest="22" WidthRequest="22" HorizontalOptions="Center" VerticalOptions="Center" />
                    </Border>
                    <VerticalStackLayout Grid.Column="1" Spacing="4" VerticalOptions="Center">
                        <Label Text="Your Name" Style="{StaticResource FormLabelStyle}" />
                        <Entry Text="{Binding OwnerName}" Placeholder="Enter your name"
                               FontSize="15" />
                    </VerticalStackLayout>
                </Grid>
            </Border>

            <!-- Preferences -->
            <Label Text="PREFERENCES" Style="{StaticResource OverlineStyle}" />

            <Border Style="{StaticResource CardStyle}">
                <VerticalStackLayout Spacing="0">
                    <Grid ColumnDefinitions="40,*,Auto" ColumnSpacing="12" Padding="0,8">
                        <Border Grid.Column="0"
                                BackgroundColor="{AppThemeBinding Light=#E8F5E9, Dark=#1B3D24}"
                                StrokeThickness="0" StrokeShape="RoundRectangle 10"
                                HeightRequest="36" WidthRequest="36">
                            <Image Source="{mi:Fluent Icon=AlertOn20}" HeightRequest="22" WidthRequest="22" HorizontalOptions="Center" VerticalOptions="Center" />
                        </Border>
                        <Label Grid.Column="1" Text="Notifications" VerticalOptions="Center"
                               FontFamily="OpenSansSemibold" />
                        <Switch Grid.Column="2" IsToggled="{Binding NotificationsEnabled}" />
                    </Grid>

                    <BoxView Style="{StaticResource DividerStyle}" Margin="52,0,0,0" />

                    <Grid ColumnDefinitions="40,*,Auto" ColumnSpacing="12" Padding="0,8">
                        <Border Grid.Column="0"
                                BackgroundColor="{AppThemeBinding Light=#E3F2FD, Dark=#1A2A3D}"
                                StrokeThickness="0" StrokeShape="RoundRectangle 10"
                                HeightRequest="36" WidthRequest="36">
                            <Image Source="{mi:Fluent Icon=Scales24}" HeightRequest="22" WidthRequest="22" HorizontalOptions="Center" VerticalOptions="Center" />
                        </Border>
                        <Label Grid.Column="1" Text="Default Weight Unit" VerticalOptions="Center"
                               FontFamily="OpenSansSemibold" />
                        <Picker Grid.Column="2" ItemsSource="{Binding WeightUnitOptions}"
                                SelectedItem="{Binding WeightUnit}" WidthRequest="80" />
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- Theme -->
            <Label Text="THEME" Style="{StaticResource OverlineStyle}" />

            <Border Style="{StaticResource CardStyle}">
                <VerticalStackLayout Spacing="12">
                    <Label Text="Choose a color theme" Style="{StaticResource SubtleTextStyle}" FontSize="14" />
                    <CollectionView ItemsSource="{Binding ThemeOptions}" SelectionMode="None"
                                    HeightRequest="90">
                        <CollectionView.ItemsLayout>
                            <LinearItemsLayout Orientation="Horizontal" ItemSpacing="12" />
                        </CollectionView.ItemsLayout>
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="vm:ThemeOption">
                                <Border StrokeShape="RoundRectangle 12" Padding="0"
                                        WidthRequest="64" HeightRequest="80"
                                        StrokeThickness="2"
                                        Stroke="{AppThemeBinding Light={StaticResource Divider}, Dark={StaticResource DividerDark}}"
                                        BackgroundColor="{Binding BackgroundColor}">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type vm:SettingsViewModel}}, Path=SelectThemeCommand}"
                                            CommandParameter="{Binding .}" />
                                    </Border.GestureRecognizers>
                                    <VerticalStackLayout VerticalOptions="Center" Spacing="6" HorizontalOptions="Center">
                                        <Border StrokeShape="RoundRectangle 14"
                                                StrokeThickness="0"
                                                BackgroundColor="{Binding PrimaryColor}"
                                                HeightRequest="28" WidthRequest="28"
                                                HorizontalOptions="Center" />
                                        <Label Text="{Binding DisplayName}" FontSize="10"
                                               HorizontalOptions="Center" HorizontalTextAlignment="Center"
                                               TextColor="{Binding PrimaryColor}"
                                               FontFamily="OpenSansSemibold"
                                               LineBreakMode="TailTruncation" MaxLines="2" />
                                    </VerticalStackLayout>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Border>

            <!-- Sync -->
            <Label Text="SYNC" Style="{StaticResource OverlineStyle}" />

            <Border Style="{StaticResource CardStyle}">
                <VerticalStackLayout Spacing="12">
                    <Grid ColumnDefinitions="40,*" ColumnSpacing="12">
                        <Border Grid.Column="0"
                                BackgroundColor="{AppThemeBinding Light=#FFF3E0, Dark=#3D2C1E}"
                                StrokeThickness="0" StrokeShape="RoundRectangle 10"
                                HeightRequest="36" WidthRequest="36">
                            <Image Source="{mi:Fluent Icon=CloudSync20}" HeightRequest="22" WidthRequest="22" HorizontalOptions="Center" VerticalOptions="Center" />
                        </Border>
                        <Label Grid.Column="1" Text="{Binding SyncStatus}"
                               VerticalOptions="Center" Style="{StaticResource SubtleTextStyle}" FontSize="14" />
                    </Grid>
                    <Button Text="Sync Now" Command="{Binding SyncNowCommand}"
                            IsEnabled="{Binding IsSyncing, Converter={StaticResource InvertedBoolConverter}}"
                            Style="{StaticResource OutlineButtonStyle}"
                            HorizontalOptions="Fill" />
                </VerticalStackLayout>
            </Border>

            <!-- About -->
            <Label Text="ABOUT" Style="{StaticResource OverlineStyle}" />

            <Border Style="{StaticResource CardStyle}">
                <VerticalStackLayout Spacing="4">
                    <Label Text="Pet Insulin Tracker" FontFamily="OpenSansSemibold" FontSize="16" />
                    <Label Text="Track your diabetic pet's insulin, feeding, and weight with ease. Share care responsibilities with family and pet sitters."
                           Style="{StaticResource SubtleTextStyle}" FontSize="13" />
                    <Label Text="Version 1.0" Style="{StaticResource SubtleTextStyle}" Margin="0,4,0,0" />
                </VerticalStackLayout>
            </Border>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
